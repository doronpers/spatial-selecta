# Environment Setup Summary

## ‚úÖ What's Configured in render.yaml

Your `render.yaml` is properly configured! Here's what will be auto-set:

### Backend Service (`spatial-selecta-api`)
- ‚úÖ `ENVIRONMENT=production` - Set automatically
- ‚úÖ `DATABASE_URL` - Auto-connected from database
- ‚úÖ `REFRESH_API_TOKEN` - Auto-generated by Render
- ‚úÖ `SCAN_INTERVAL_HOURS=48` - Set automatically
- ‚ö†Ô∏è `ALLOWED_ORIGINS` - **YOU MUST SET THIS MANUALLY** (marked `sync: false`)
- ‚ö†Ô∏è `APPLE_MUSIC_DEVELOPER_TOKEN` - **YOU MUST SET THIS MANUALLY** (marked `sync: false`)

### Frontend Service (`spatial-selecta-frontend`)
- ‚úÖ API URL auto-detection - Updated `app.js` to detect Render subdomains
- No environment variables needed (static sites can't use them)

### Database (`spatial-selecta-db`)
- ‚úÖ PostgreSQL database will be created automatically
- ‚úÖ Connection string auto-provided to backend

---

## ‚ö†Ô∏è What You Need to Set Manually

After deploying via Render Blueprint, you need to manually set 2 environment variables:

### 1. APPLE_MUSIC_DEVELOPER_TOKEN
**Where:** Render Dashboard ‚Üí `spatial-selecta-api` ‚Üí Environment tab  
**Value:** Your Apple Music JWT developer token  
**Format:** `eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6...`

### 2. ALLOWED_ORIGINS
**Where:** Render Dashboard ‚Üí `spatial-selecta-api` ‚Üí Environment tab  
**Value:** Your frontend URL(s), comma-separated  
**Example:** `https://spatial-selecta-frontend.onrender.com`  
**If using custom domain:** `https://yourdomain.com,https://www.yourdomain.com`

**Important:** 
- No wildcards (`*`) allowed
- Include protocol (`https://`)
- No trailing slashes
- Comma-separated for multiple origins

---

## üîß Recent Fixes Applied

### Frontend API URL Detection
Updated `app.js` to automatically detect Render deployment:
- If hostname contains `onrender.com`, it will use the backend subdomain
- Example: `spatial-selecta-frontend.onrender.com` ‚Üí `https://spatial-selecta-api.onrender.com/api`
- No manual configuration needed!

---

## üìã Post-Deployment Checklist

After deploying with Render Blueprint:

1. [ ] **Deploy completes successfully**
   - Check Render Dashboard for deployment status

2. [ ] **Set APPLE_MUSIC_DEVELOPER_TOKEN**
   - Go to `spatial-selecta-api` ‚Üí Environment
   - Add variable with your token

3. [ ] **Set ALLOWED_ORIGINS**
   - Go to `spatial-selecta-api` ‚Üí Environment  
   - Add variable with frontend URL (get from frontend service URL)

4. [ ] **Restart backend service** (if needed)
   - After setting env vars, restart to apply changes

5. [ ] **Initialize database**
   - Go to `spatial-selecta-api` ‚Üí Shell
   - Run: `python3 backend/setup.py`
   - Enter `y` to import from data.json (optional)

6. [ ] **Verify backend health**
   ```bash
   curl https://spatial-selecta-api.onrender.com/api/health
   ```
   Should return: `{"status": "healthy", ...}`

7. [ ] **Check backend logs**
   - Look for: "Application started successfully"
   - Look for: "Background scheduler started"
   - ‚ö†Ô∏è No warnings about missing tokens

8. [ ] **Test frontend**
   - Visit frontend URL
   - Open browser console
   - Should see: "Loaded X tracks from API"
   - No CORS errors

---

## üêõ Troubleshooting

### "Apple Music Developer Token not configured"
‚Üí Set `APPLE_MUSIC_DEVELOPER_TOKEN` in Render Dashboard

### CORS errors in browser console
‚Üí Check `ALLOWED_ORIGINS` matches frontend URL exactly

### Frontend can't connect to API
‚Üí Check backend service is running and healthy
‚Üí Verify API URL detection in browser console

### Database connection errors
‚Üí `DATABASE_URL` should auto-set, but verify database service is running

---

## üéØ Quick Verification

Run these commands after deployment:

```bash
# 1. Health check
curl https://spatial-selecta-api.onrender.com/api/health

# 2. Get stats
curl https://spatial-selecta-api.onrender.com/api/stats

# 3. Get tracks
curl https://spatial-selecta-api.onrender.com/api/tracks?limit=5
```

All should return JSON responses without errors.

---

**Status:** ‚úÖ Configuration is ready! Just need to set 2 environment variables after deployment.

