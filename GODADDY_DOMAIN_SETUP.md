# Connecting spatialselects.com (GoDaddy) to Render.com

This guide walks through connecting your GoDaddy domain to your Render.com deployment.

## Prerequisites
- Active Render.com account with deployed services
- Access to GoDaddy DNS management for spatialselects.com
- Apple Music Developer Token (required for backend)

## Step 1: Deploy to Render.com

### 1.1 Initial Deployment
1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click **New** → **Blueprint**
3. Connect your GitHub repository: `doronpers/spatial-selecta`
4. Render will detect `render.yaml` automatically
5. Click **Apply**

### 1.2 Configure Environment Variables
Before deployment completes, add these required environment variables:

**For `spatial-selecta-api` service:**
- `APPLE_MUSIC_DEVELOPER_TOKEN`: Your Apple Music API token (REQUIRED)
- `REFRESH_API_TOKEN`: Auto-generated by Render (keep as is)
- `ALLOWED_ORIGINS`: Already set to `https://spatialselects.com,https://www.spatialselects.com`

**Important:** Without `APPLE_MUSIC_DEVELOPER_TOKEN`, the backend will not function.

### 1.3 Wait for Deployment
- Backend will deploy to: `https://spatial-selecta-api.onrender.com`
- Frontend will deploy to: `https://spatial-selecta-frontend.onrender.com`

## Step 2: Configure Custom Domain in Render

### 2.1 Add Custom Domain to Frontend Service
1. In Render Dashboard, go to `spatial-selecta-frontend` service
2. Click **Settings** → **Custom Domains**
3. Click **Add Custom Domain**
4. Add: `spatialselects.com`
5. Click **Add Custom Domain** again
6. Add: `www.spatialselects.com`

### 2.2 Note DNS Records
Render will provide you with DNS records. They will look like:

**For spatialselects.com (apex domain):**
- Type: `A`
- Name: `@`
- Value: `216.24.57.1` (example - use actual value from Render)

**For www.spatialselects.com:**
- Type: `CNAME`
- Name: `www`
- Value: `spatial-selecta-frontend.onrender.com`

**Copy these values - you'll need them for GoDaddy.**

## Step 3: Configure DNS in GoDaddy

### 3.1 Access GoDaddy DNS Management
1. Log in to [GoDaddy](https://www.godaddy.com)
2. Go to **My Products**
3. Find `spatialselects.com`
4. Click **DNS** (or **Manage DNS**)

### 3.2 Add/Update DNS Records

#### For Apex Domain (spatialselects.com):
1. Look for existing `A` record with Name `@`
2. If exists, click **Edit**, if not, click **Add**
3. Set:
   - **Type**: A
   - **Name**: @
   - **Value**: (IP address from Render, e.g., `216.24.57.1`)
   - **TTL**: 600 seconds (default)
4. Click **Save**

#### For www Subdomain (www.spatialselects.com):
1. Look for existing `CNAME` record with Name `www`
2. If exists, click **Edit**, if not, click **Add**
3. Set:
   - **Type**: CNAME
   - **Name**: www
   - **Value**: `spatial-selecta-frontend.onrender.com`
   - **TTL**: 600 seconds (default)
4. Click **Save**

### 3.3 DNS Propagation
- DNS changes can take 10 minutes to 48 hours to propagate
- Usually takes 10-30 minutes
- Check status: https://dnschecker.org/#A/spatialselects.com

## Step 4: Verify SSL Certificate

1. After DNS propagates, Render automatically provisions SSL certificate
2. This usually takes 1-5 minutes after DNS verification
3. Your site will be accessible at:
   - https://spatialselects.com ✅
   - https://www.spatialselects.com ✅

## Step 5: Test Deployment

### 5.1 Check Frontend
Visit https://spatialselects.com - you should see:
- ✅ Spatial Selecta homepage
- ✅ Music grid with tracks
- ✅ No CORS errors in browser console

### 5.2 Check Backend API
```bash
# Health check
curl https://spatial-selecta-api.onrender.com/api/health

# Should return:
# {"status":"healthy","timestamp":"2025-12-27T..."}

# Get stats
curl https://spatial-selecta-api.onrender.com/api/stats
```

### 5.3 Check Browser Console
Open browser DevTools (F12) → Console:
- Should see: `Loaded X tracks from API`
- Should NOT see CORS errors

## Troubleshooting

### Domain not resolving
**Problem:** spatialselects.com shows GoDaddy parking page
**Solution:** 
- Verify DNS records are correct in GoDaddy
- Wait 30 minutes for propagation
- Clear browser cache

### CORS errors in browser
**Problem:** Frontend shows: `Access to fetch at 'https://spatial-selecta-api.onrender.com/api/tracks' from origin 'https://spatialselects.com' has been blocked by CORS policy`
**Solution:**
- Check `ALLOWED_ORIGINS` in Render backend environment variables
- Must include: `https://spatialselects.com,https://www.spatialselects.com`
- Restart backend service after changing

### Backend shows "Apple Music Developer Token not configured"
**Problem:** Backend logs show token warning
**Solution:**
- Add `APPLE_MUSIC_DEVELOPER_TOKEN` to backend environment variables
- Get token from: https://developer.apple.com/documentation/applemusicapi/getting_keys_and_creating_tokens
- Restart backend service

### SSL certificate not provisioning
**Problem:** Site shows "Not Secure" or certificate error
**Solution:**
- Verify DNS is pointing to correct Render IP/CNAME
- Wait 5-10 minutes after DNS propagation
- In Render, go to Settings → Custom Domains → click "Verify" button

## Apple Music API Token Setup

Since you chose **Option A (Pre-generated JWT Token)**, follow these steps:

### Get Developer Token
1. **Join Apple Developer Program** ($99/year)
   - https://developer.apple.com/programs/

2. **Create MusicKit Identifier**
   - https://developer.apple.com/account/
   - Go to: Certificates, Identifiers & Profiles
   - Create new MusicKit Identifier

3. **Generate Private Key (.p8 file)**
   - In Apple Developer Portal, create a new key
   - Enable MusicKit
   - Download the .p8 file (save it securely!)

4. **Generate JWT Token**
   - Use the MusicKit token generator tool
   - Or use this Python script:

```python
# generate_musickit_token.py
import jwt
import time
from datetime import datetime, timedelta

# Your credentials (replace with actual values)
TEAM_ID = "YOUR_10_DIGIT_TEAM_ID"
KEY_ID = "YOUR_KEY_ID"
PRIVATE_KEY_PATH = "AuthKey_XXXXXXXXXX.p8"

# Read private key
with open(PRIVATE_KEY_PATH, 'r') as f:
    private_key = f.read()

# Generate token (valid for 6 months)
headers = {
    "alg": "ES256",
    "kid": KEY_ID
}

payload = {
    "iss": TEAM_ID,
    "iat": int(time.time()),
    "exp": int(time.time()) + (86400 * 180)  # 180 days
}

token = jwt.encode(payload, private_key, algorithm="ES256", headers=headers)
print(f"Your Apple Music Developer Token:\n{token}")
print(f"\nValid until: {datetime.now() + timedelta(days=180)}")
```

5. **Add Token to Render**
   - Go to Render Dashboard → `spatial-selecta-api`
   - Settings → Environment Variables
   - Add: `APPLE_MUSIC_DEVELOPER_TOKEN` = `your_generated_token`
   - Click **Save**
   - Service will auto-redeploy

### Generate Secure Refresh Token
```bash
python -c "import secrets; print(secrets.token_urlsafe(32))"
```
Copy the output and add it to `REFRESH_API_TOKEN` in Render (if not auto-generated).

## Monitoring & Maintenance

### Check Logs
- Render Dashboard → Service → Logs tab
- Monitor for errors or API issues

### Database Backups
- Render automatically backs up PostgreSQL database
- View backups: Database → Backups tab

### Token Renewal
- Apple Music Developer Token expires after 6 months
- Set calendar reminder to regenerate token
- Update in Render environment variables before expiry

## Support
- Render Docs: https://render.com/docs
- GoDaddy DNS Help: https://www.godaddy.com/help/manage-dns-records-680
- Apple MusicKit: https://developer.apple.com/documentation/applemusicapi
